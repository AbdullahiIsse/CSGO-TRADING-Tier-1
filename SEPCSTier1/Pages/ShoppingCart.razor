@page "/Cart"
@using SEPCSTier1.Models
@using SEPCSTier1.Data
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage

@inject IShoppingCartData ShoppingCartData
@inject IToastService toastService
@inject ProtectedSessionStorage ProtectedSessionStore

<h3>ShoppingCart</h3>


<div class="container-md">
    <div class="row">
        <div class="col">

            <h1>Shopping Cart</h1>

            <table class="table">
                <thead>
                <tr>
                    <th>SaleOfferId</th>
                    <th>ItemID</th>
                    <th>SkinName</th>
                    <th>Price</th>
                </tr>
                </thead>


                <tbody class="text-gray-700">

                @foreach (var shoppingCart in shoppingCarts)
                {
                    <tr>
                        <td class="w-1/3 text-left py-3 px-4">@shoppingCart.sale_offer_id</td>
                        <td class="w-1/3 text-left py-3 px-4">@shoppingCart.item_id</td>
                        <td class="w-1/3 text-left py-3 px-4">@shoppingCart.weaponname</td>
                        <td class="w-1/3 text-left py-3 px-4">@shoppingCart.sale_price</td>
                        

                    </tr>
                   
                }

                <thead>
                <tr>
                    <th>Total Price</th>
                    <th></th>
                    <th>@totalPrice â‚¬</th>
                    
                    
                </tr>
                </thead> 
 
                </tbody>
            </table>
            
              <button type="button" class="btn btn-lg btn-primary" @onclick="@(() => {  toastService.ShowSuccess("test"); })">Buy</button>
             
        </div>
    </div>
</div>


@code {

    private IList<ShowShoppingCart> shoppingCarts = new List<ShowShoppingCart>() ;
    public long id { get; set; }
    public long totalPrice { get; set; }

    protected override async Task OnInitializedAsync()
    {
       var protectedBrowserStorageResultId = await ProtectedSessionStore.GetAsync<long>("id");
        id = protectedBrowserStorageResultId.Value;
        shoppingCarts = await ShoppingCartData.GetShoppingCartById(id);
        totalPrice = await ShoppingCartData.GetTotalPrice(id);


    }

    

}